<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Azure DevOps AI Review</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup">
    <header class="header">
      <div class="logo">
        <span class="logo-icon">ü§ñ</span>
        <h1>AI Code Review</h1>
      </div>
      <nav class="nav">
        <button class="nav-btn active" data-tab="status">Status</button>
        <button class="nav-btn" data-tab="providers">Providers</button>
        <button class="nav-btn" data-tab="rules">Rules</button>
        <button class="nav-btn" data-tab="history">History</button>
        <button class="nav-btn" data-tab="settings">Settings</button>
      </nav>
    </header>

    <!-- Status Tab -->
    <section id="tab-status" class="tab-content active">
      <div class="status-card">
        <div class="status-indicator" id="status-indicator">
          <span class="status-dot"></span>
          <span class="status-text">Checking...</span>
        </div>
        <p class="status-description" id="status-description"></p>
      </div>

      <div class="current-provider" id="current-provider">
        <h3>Active Provider</h3>
        <div class="provider-info" id="provider-info">
          <p>No provider configured</p>
        </div>
      </div>

      <div class="quick-actions">
        <button class="btn" id="btn-test-connection">Test Connection</button>
      </div>
    </section>

    <!-- Providers Tab -->
    <section id="tab-providers" class="tab-content">
      <div class="provider-list" id="provider-list">
        <!-- Populated by JS -->
      </div>

      <div class="add-provider">
        <h3>Add Provider</h3>
        <select id="provider-select">
          <option value="">Select a provider...</option>
        </select>

        <div id="provider-form" class="provider-form hidden">
          <!-- Dynamic form fields -->
        </div>
      </div>
    </section>

    <!-- Rules Tab -->
    <section id="tab-rules" class="tab-content">
      <div class="settings-group">
        <h3>Review Scope</h3>
        <p class="help-text">What should the AI analyze?</p>
        <select id="rule-scope">
          <option value="changes-only" selected>Only changed lines (recommended)</option>
          <option value="changes-context">Changed lines + surrounding context</option>
          <option value="full-file">Full file content (may cause inaccurate reviews)</option>
        </select>
        <p class="help-text" style="margin-top: 8px; color: #ff9800;">
          ‚ö†Ô∏è "Full file" may report issues in code that wasn't modified in the PR.
        </p>
      </div>

      <div class="settings-group">
        <h3>Review Focus</h3>
        <p class="help-text">Select what aspects the AI should prioritize:</p>
        <div class="checkbox-group">
          <label class="checkbox-label">
            <input type="checkbox" id="rule-security" checked>
            <span>üîí Security vulnerabilities</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="rule-performance" checked>
            <span>‚ö° Performance issues</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="rule-clean-code" checked>
            <span>‚ú® Clean code / Best practices</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="rule-bugs" checked>
            <span>üêõ Potential bugs</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="rule-tests" checked>
            <span>üß™ Test coverage suggestions</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" id="rule-docs" checked>
            <span>üìù Documentation</span>
          </label>
        </div>
      </div>

      <div class="settings-group">
        <h3>Severity Level</h3>
        <p class="help-text">Minimum severity to report:</p>
        <select id="rule-severity">
          <option value="all">All issues</option>
          <option value="low">Low and above</option>
          <option value="medium" selected>Medium and above</option>
          <option value="high">High only</option>
        </select>
      </div>

      <div class="settings-group">
        <h3>Ignore Patterns</h3>
        <p class="help-text">File patterns to skip (one per line):</p>
        <textarea id="rule-ignore" rows="4" placeholder="*.json
*.md
*.txt
**/node_modules/**"></textarea>
      </div>

      <div class="settings-group">
        <h3>Custom Instructions</h3>
        <p class="help-text">Additional context for the AI reviewer:</p>
        <textarea id="rule-custom" rows="4" placeholder="Example:
- We use PascalCase for class names
- All public methods need XML docs
- Prefer async/await over callbacks"></textarea>
      </div>

      <div class="settings-group">
        <button class="btn" id="btn-save-rules">üíæ Save Rules</button>
      </div>
    </section>

    <!-- History Tab -->
    <section id="tab-history" class="tab-content">
      <div class="history-header">
        <h3>Review History</h3>
        <button class="btn btn-small btn-danger" id="btn-clear-history">Clear All</button>
      </div>
      <div class="history-list" id="history-list">
        <p class="empty-state">No reviews yet. Start reviewing PRs to build your history.</p>
      </div>
    </section>

    <!-- Settings Tab -->
    <section id="tab-settings" class="tab-content">
      <div class="settings-group">
        <h3>Azure DevOps</h3>
        <div class="form-field">
          <label for="azure-token">Personal Access Token (PAT)</label>
          <input type="password" id="azure-token" placeholder="Enter your PAT">
          <button class="btn btn-small" id="btn-save-token">Save</button>
          <p class="help-text">
            Required for private repositories. 
            <a href="https://docs.microsoft.com/en-us/azure/devops/organizations/accounts/use-personal-access-tokens-to-authenticate" target="_blank">
              How to create a PAT
            </a>
          </p>
        </div>
      </div>

      <div class="settings-group">
        <h3>GitHub Token</h3>
        <div class="form-field">
          <label for="github-token">Personal Access Token</label>
          <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
          <button class="btn btn-small" id="btn-save-github-token">Save</button>
          <p class="help-text">
            Required for GitHub Models API.
            <a href="https://github.com/settings/tokens" target="_blank">
              Create a token
            </a> with <code>models:read</code> scope.
          </p>
        </div>
      </div>

      <div class="settings-group">
        <h3>Review Language</h3>
        <div class="form-field">
          <select id="review-language">
            <option value="English">English</option>
            <option value="Portuguese">Portugu√™s</option>
            <option value="Spanish">Espa√±ol</option>
            <option value="French">Fran√ßais</option>
            <option value="German">Deutsch</option>
            <option value="Japanese">Êó•Êú¨Ë™û</option>
            <option value="Chinese">‰∏≠Êñá</option>
          </select>
        </div>
      </div>

      <div class="settings-group">
        <h3>Diff Limits</h3>
        <p class="help-text" style="margin-bottom: 12px;">
          Controls how many files are included in the review. All selected files are fetched completely.
        </p>
        <div class="form-field">
          <label for="max-files">Max Files to Analyze</label>
          <select id="max-files">
            <option value="25">25 files</option>
            <option value="40" selected>40 files (Recommended)</option>
            <option value="60">60 files</option>
            <option value="100">100 files</option>
            <option value="200">200 files (Very Large PRs)</option>
          </select>
          <p class="help-text">More files = slower and more expensive API calls</p>
        </div>
        <button class="btn btn-small" id="btn-save-limits">Save Limits</button>
      </div>

      <div class="settings-group">
        <h3>About</h3>
        <p class="version">Version 1.0.0</p>
        <p class="help-text">
          AI-powered code reviews for Azure DevOps.
          <br>
          Connect your preferred AI model and get instant feedback on pull requests.
        </p>
      </div>
    </section>
  </div>

  <script src="popup.js" type="module"></script>
</body>
</html>
